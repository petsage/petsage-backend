`STATUS: ACKNOWLEDGED`
`PAYLOAD RECEIVED`
`AGENT: PetSage Backend Feature Builder Agent`
`ACTION: INITIATING FEATURE BUILD`

Decoding payload...
- **Feature:** `smoke_test`
- **Description:** "verify logs"
- **Requirements:** "none"

Acknowledged. The request is for a simple smoke test endpoint. This is a foundational health check feature used to verify that the service is running, responsive, and that the logging pipeline is operational.

I will now construct the complete backend module for the `smoke_test` feature, adhering to the PetSage System Blueprint. The build will include Pydantic models, FastAPI router, service logic, integration steps, and a full test suite.

---

### **`FEATURE BUILD: smoke_test`**

#### **1. Overview & Design**

The `smoke_test` feature provides a public, unauthenticated `GET` endpoint at `/health/smoke-test`.

**Workflow:**
1.  A client sends a `GET` request to `/health/smoke-test`.
2.  The endpoint handler is triggered.
3.  The service layer logs a specific message (`Smoke test successful...`) to verify the logging system.
4.  The service layer constructs a success response payload.
5.  The endpoint returns a `200 OK` response with a JSON body confirming the system's health.

This design is simple, robust, and directly fulfills the "verify logs" requirement.

---

#### **2. File Structure**

Here is the complete file and directory structure for the new feature and its associated tests.

```
petsage_backend/
├── features/
│   ├── __init__.py
│   └── smoke_test/
│       ├── __init__.py
│       ├── router.py        # Renamed from main.py for clarity
│       ├── models.py
│       └── service.py
├── tests/
│   ├── __init__.py
│   └── features/
│       ├── __init__.py
│       └── test_smoke_test.py
└── main.py                # Main application entry point (for integration)
```

---

#### **3. Pydantic Models**

These models define the data contract for our API endpoint, ensuring type safety and clear documentation.

**File:** `petsage_backend/features/smoke_test/models.py`
```python
"""Pydantic models for the Smoke Test feature."""

from pydantic import BaseModel, Field
from datetime import datetime

class SmokeTestResponse(BaseModel):
    """
    Defines the successful response structure for the smoke test endpoint.
    """
    status: str = Field(
        ...,
        example="ok",
        description="Indicates the operational status of the service."
    )
    message: str = Field(
        ...,
        example="PetSage backend is healthy and logging is verified.",
        description="A human-readable message confirming the system status."
    )
    timestamp: datetime = Field(
        ...,
        description="The UTC timestamp when the health check was performed."
    )

```

---

#### **4. Service Layer (Business Logic)**

This layer contains the core logic. For this feature, it's responsible for logging the verification message and preparing the response data.

**File:** `petsage_backend/features/smoke_test/service.py`
```python
"""Service layer for the Smoke Test feature."""

import logging
from datetime import datetime, timezone
from typing import Dict, Any

# It is best practice to get the logger for the current module.
# The root logger will be configured in the main application entry point.
logger = logging.getLogger(__name__)

def run_smoke_test() -> Dict[str, Any]:
    """
    Performs the smoke test logic.

    This involves logging a verification message and returning a
    structured success response.

    Returns:
        A dictionary containing the status, message, and timestamp.
    """
    # The primary requirement is to verify logs are working.
    logger.info("Smoke test endpoint executed. Logging pipeline is active.")

    response_data = {
        "status": "ok",
        "message": "PetSage backend is healthy and logging is verified.",
        "timestamp": datetime.now(timezone.utc)
    }
    return response_data

```

---

#### **5. FastAPI Router (API Endpoint)**

This file defines the API endpoint, handles incoming requests, calls the service layer, and returns the response.

**File:** `petsage_backend/features/smoke_test/router.py`
```python
"""API Router for the Smoke Test feature."""

from fastapi import APIRouter, status
from . import models
from . import service

# Create a new router for this feature
# This helps in organizing endpoints and can be included in the main app
router = APIRouter(
    prefix="/health",
    tags=["Health Checks"]
)

@router.get(
    "/smoke-test",
    response_model=models.SmokeTestResponse,
    status_code=status.HTTP_200_OK,
    summary="Perform a simple smoke test",
    description="""
    This endpoint verifies that the PetSage backend service is running,
    responsive, and that the logging system is operational. It returns a
    confirmation message with a current timestamp.
    """
)
def get_smoke_test():
    """
    Endpoint to perform a basic smoke test of the application.
    """
    # Delegate the logic to the service layer
    health_data = service.run_smoke_test()
    return health_data

```

---

#### **6. Orchestration Pipeline Integration**

To make the new endpoint accessible, its router must be included in the main FastAPI application.

**File:** `petsage_backend/main.py` (Instructions for modification)
```python
"""Main PetSage Backend Application."""

import logging
from fastapi import FastAPI
from contextlib import asynccontextmanager

# Import the new router from the smoke_test feature
from features.smoke_test.router import router as smoke_test_router

# --- Assume logging is configured here ---
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
# -----------------------------------------

@asynccontextmanager
async def lifespan(app: FastAPI):
    # Code to run on startup
    logging.info("Starting up PetSage Backend...")
    yield
    # Code to run on shutdown
    logging.info("Shutting down PetSage Backend...")

app = FastAPI(
    title="PetSage Backend API",
    description="""
    Welcome to the PetSage API. Your trusted partner in pet wellness.
    This service provides AI-driven insights and tools for pet care.
    """,
    version="1.0.0",
    lifespan=lifespan
)

# --- Integration Point ---
# Include the new smoke_test router in the main application
# All routes defined in the smoke_test router will now be available.
app.include_router(smoke_test_router)
# -------------------------

# Add other feature routers here as they are built...
# from features.another_feature.router import router as another_router
# app.include_router(another_router)


@app.get("/", tags=["Root"])
def read_root():
    """A warm welcome to the PetSage API."""
    return {"message": "Welcome to the PetSage API! We're happy to see you."}

```

---

#### **7. Test Suite**

A robust test is crucial to ensure the feature works as expected and prevents future regressions.

**File:** `petsage_backend/tests/features/test_smoke_test.py`
```python
"""Tests for the Smoke Test feature."""

import pytest
from fastapi.testclient import TestClient
from datetime import datetime, timezone

# We test against the main app instance to ensure routing is correct
from petsage_backend.main import app

client = TestClient(app)

def test_smoke_test_endpoint_success():
    """
    Tests the GET /health/smoke-test endpoint for a successful response.
    """
    # --- Arrange ---
    # No arrangement needed for this simple test

    # --- Act ---
    response = client.get("/health/smoke-test")

    # --- Assert ---
    # 1. Check for a 200 OK status code
    assert response.status_code == 200

    # 2. Parse the JSON response
    data = response.json()

    # 3. Verify the structure and content of the response
    assert "status" in data
    assert data["status"] == "ok"

    assert "message" in data
    assert data["message"] == "PetSage backend is healthy and logging is verified."

    assert "timestamp" in data
    # 4. Verify the timestamp is a valid ISO 8601 datetime string
    try:
        timestamp = datetime.fromisoformat(data["timestamp"].replace('Z', '+00:00'))
        # Ensure the timestamp is recent (e.g., within the last 5 seconds)
        assert (datetime.now(timezone.utc) - timestamp).total_seconds() < 5
    except (ValueError, TypeError):
        pytest.fail("Timestamp is not in a valid ISO 8601 format.")

def test_smoke_test_endpoint_headers():
    """
    Ensures the response has the correct content-type header.
    """
    response = client.get("/health/smoke-test")
    assert response.headers["content-type"] == "application/json"

```

---

`STATUS: COMPLETE`
`FEATURE: smoke_test`
`ACTION: BUILD FINISHED. Awaiting next instruction.`