{
  "feature": "triage_orchestrator_v2_full_code",
  "description": "Generate the complete PetSage Integration Layer (triage_orchestrator_v2) that unifies all 12 engines into one clinically consistent, auditable, and regulator-ready triage pipeline. No placeholders, no stubs, no TODOs. Output must include full code, documentation, engine sequencing, correlation ID propagation, safety gating, observability hooks, fallback logic, and integration instructions.",
  "requirements": [
    "=== 1. CREATE DIRECTORY STRUCTURE ===",
    "Create new folder triage_orchestrator_v2/ with submodules:",
    " \u2022 orchestrator.py",
    " \u2022 state_manager.py",
    " \u2022 engine_router.py",
    " \u2022 safety_gate.py",
    " \u2022 governance_enforcer.py",
    " \u2022 fallback_manager.py",
    " \u2022 correlation.py",
    " \u2022 schemas.py",
    " \u2022 utils.py",
    "=== 2. ORCHESTRATOR CORE ===",
    "Implement TriageOrchestratorV2 class responsible for the full 12-engine pipeline:",
    " 1. language_engine",
    " 2. preprocessor",
    " 3. entity_engine",
    " 4. profile/species engine",
    " 5. RAG retrieval",
    " 6. LLM reasoning engine",
    " 7. safety scoring",
    " 8. observability logging hooks",
    " 9. anomaly detection hook",
    " 10. drift detection hook",
    " 11. follow-up question engine",
    " 12. next-steps engine",
    "Integrate observability_engine and safety/governance engines seamlessly.",
    "Return unified TriageResponseV2 schema with full metadata.",
    "=== 3. STATE MANAGER ===",
    "Implement a state manager handling:",
    " \u2022 correlation_id propagation",
    " \u2022 per-step timestamps",
    " \u2022 engine intermediate outputs",
    " \u2022 sanitized reasoning traces",
    " \u2022 safe error states and graceful fallbacks",
    "State must be serializable to JSON for audit pipelines.",
    "=== 4. ENGINE ROUTER ===",
    "Build an engine router that loads engines dynamically and executes them in sequence.",
    "Include retry logic, fallback sequencing, and model version locking.",
    "Each step must emit observability events + safety metadata.",
    "=== 5. SAFETY GATE ===",
    "Before producing final output, enforce:",
    " \u2022 minimum safety_score threshold",
    " \u2022 red-flag override logic",
    " \u2022 anomaly gating",
    " \u2022 hallucination-risk override",
    "If thresholds fail, trigger fallback_manager emergency route.",
    "=== 6. GOVERNANCE ENFORCER ===",
    "Apply governance controls:",
    " \u2022 reasoning depth limits",
    " \u2022 allowed model versions",
    " \u2022 mandatory trace creation",
    " \u2022 EU AI Act transparency/record-keeping requirements",
    " \u2022 ISO 27001 alignment checks",
    "Output governance_report for every triage request.",
    "=== 7. FALLBACK MANAGER ===",
    "Implement fallback logic for:",
    " \u2022 missing entities",
    " \u2022 RAG failure",
    " \u2022 low-confidence reasoning",
    " \u2022 safety threshold breaches",
    "Fallback paths must be deterministic and logged.",
    "=== 8. CORRELATION MODULE ===",
    "Implement correlation_id generator + propagator using UUID and time entropy.",
    "Must be injected into every engine and log file path.",
    "Ensure compatibility with observability_engine\u2019s trace/cost/log directories.",
    "=== 9. SCHEMAS MODULE ===",
    "Define Pydantic models for:",
    " \u2022 OrchestratorInputV2",
    " \u2022 OrchestratorStateV2",
    " \u2022 EngineResult",
    " \u2022 ErrorResult",
    " \u2022 TriageResponseV2",
    "Include docstrings and full field validation.",
    "=== 10. UTILS MODULE ===",
    "Provide helpers for:",
    " \u2022 timestamp handling",
    " \u2022 sanitisation",
    " \u2022 safe JSON encoding",
    " \u2022 retry wrappers",
    " \u2022 structured logging helpers",
    "=== 11. DOCUMENTATION ===",
    "Generate README.md with:",
    " \u2022 architecture diagram description",
    " \u2022 engine sequencing",
    " \u2022 data flow",
    " \u2022 correlation + logging model",
    " \u2022 safety + governance interplay",
    " \u2022 integration with FastAPI main.py",
    "Also generate docs/orchestrator_integration_guide.md.",
    "=== 12. OUTPUT LOCATION ===",
    "Write full code as files to: agent_artifacts/triage_orchestrator_v2_code/.",
    "Commit them cleanly to GitHub.",
    "=== 13. STRICT RULES ===",
    "Do NOT deploy.",
    "Do NOT modify existing triage_engine/ or active backend.",
    "Do NOT interfere with ongoing long-running tasks.",
    "Do NOT overwrite v52.",
    "This is code generation ONLY."
  ],
  "status": "builder pipeline success"
}