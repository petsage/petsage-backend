**[PetSage Backend Feature Builder Agent]**
Status: `ACTIVE`
Task: Process new feature request.
Payload Received: `Success`
Decoding Payload... `Success`

**Decoded Request:**
*   **Feature:** `smoke_test`
*   **Description:** "Check system is alive"
*   **Requirements:** "none"

Acknowledged. Initiating feature build protocol for the `smoke_test` feature. This will serve as a vital health check endpoint for system monitoring and orchestration. Adhering to the PetSage System Blueprint.

---

### 1. Feature Build Plan

1.  **Objective:** Create a `/api/v1/health` endpoint.
2.  **Method:** Use a `GET` request.
3.  **Response:** Return a `200 OK` status with a JSON body confirming the system is operational.
4.  **Models:** Design a Pydantic `HealthCheckResponse` schema for a consistent and documented response structure.
5.  **Structure:** Implement the feature within a modular file structure: `endpoints/health.py` and `schemas/health.py`.
6.  **Integration:** Add the new endpoint's router to the main FastAPI application instance (`main.py`).
7.  **Testing:** Create a corresponding test file `tests/api/v1/test_health.py` to ensure endpoint reliability.
8.  **Branding:** The response message will align with the friendly, positive PetSage brand voice.

---

### 2. Generated File Structure

Here is the complete file and directory structure for the new feature.

```
petsage_api/
├── __init__.py
├── api/
│   ├── __init__.py
│   ├── v1/
│   │   ├── __init__.py
│   │   ├── endpoints/
│   │   │   ├── __init__.py
│   │   │   └── health.py         # <-- NEW: Endpoint logic
│   │   └── schemas/
│   │       ├── __init__.py
│   │       └── health.py         # <-- NEW: Pydantic response model
├── core/
│   ├── __init__.py
│   └── config.py
├── tests/
│   ├── __init__.py
│   └── api/
│       ├── __init__.py
│       └── v1/
│           ├── __init__.py
│           └── test_health.py    # <-- NEW: Unit tests
└── main.py                     # <-- MODIFIED: To include the new router
```

---

### 3. Generated Code Modules

Below are the complete code modules for the `smoke_test` feature.

#### **Module 1: Pydantic Schema**

This model defines the structure and provides documentation for our API response.

**File:** `petsage_api/api/v1/schemas/health.py`
```python
# petsage_api/api/v1/schemas/health.py

from pydantic import BaseModel, Field

class HealthCheckResponse(BaseModel):
    """
    Response model for the health check endpoint.
    Indicates the operational status of the PetSage API.
    """
    status: str = Field(
        default="ok",
        example="ok",
        description="The operational status of the service."
    )
    message: str = Field(
        default="PetSage system is wagging its tail!",
        example="PetSage system is wagging its tail!",
        description="A friendly message indicating the system is alive and well."
    )

    class Config:
        schema_extra = {
            "example": {
                "status": "ok",
                "message": "PetSage system is wagging its tail!"
            }
        }
```

#### **Module 2: API Endpoint**

This module contains the router and the core logic for the health check endpoint.

**File:** `petsage_api/api/v1/endpoints/health.py`
```python
# petsage_api/api/v1/endpoints/health.py

from fastapi import APIRouter, status
from petsage_api.api.v1.schemas.health import HealthCheckResponse

router = APIRouter()

@router.get(
    "/health",
    response_model=HealthCheckResponse,
    status_code=status.HTTP_200_OK,
    tags=["System"],
    summary="Perform a System Health Check",
    description="Checks if the PetSage API is alive and responding. A 200 OK response indicates the system is healthy.",
)
def perform_health_check() -> HealthCheckResponse:
    """
    A simple endpoint to confirm the API is running.

    This is commonly used by load balancers, container orchestrators (like Kubernetes),
    or monitoring systems to verify service health.

    Returns:
        HealthCheckResponse: An object indicating the system status.
    """
    return HealthCheckResponse()
```

---

### 4. Orchestration Pipeline Integration

To activate the new endpoint, its router must be included in the main FastAPI application.

**File:** `petsage_api/main.py` (Modified)
```python
# petsage_api/main.py

from fastapi import FastAPI
from petsage_api.api.v1.endpoints import health  # <-- IMPORT new router

# --- PetSage Branding & App Info ---
TITLE = "PetSage API"
DESCRIPTION = """
Welcome to the PetSage API. Your wise companion for all pet-related queries.
This API provides intelligent services for pet owners, vets, and enthusiasts.
"""
VERSION = "1.0.0"

# --- Safety Rules: Disable docs in production ---
# from petsage_api.core.config import settings
# docs_url = "/docs" if settings.ENVIRONMENT != "production" else None
# redoc_url = "/redoc" if settings.ENVIRONMENT != "production" else None
# app = FastAPI(title=TITLE, description=DESCRIPTION, version=VERSION, docs_url=docs_url, redoc_url=redoc_url)

app = FastAPI(
    title=TITLE,
    description=DESCRIPTION,
    version=VERSION,
    contact={
        "name": "PetSage Support",
        "email": "support@petsage.ai",
    },
)


# --- API Router Integration ---
# Include the router for the health check endpoint
app.include_router(health.router, prefix="/api/v1", tags=["System"])


# Root endpoint for basic discovery
@app.get("/", include_in_schema=False)
def read_root():
    return {"message": f"Welcome to {TITLE} v{VERSION}"}

# Placeholder for other feature routers
# from petsage_api.api.v1.endpoints import pet_profiles, advice
# app.include_router(pet_profiles.router, prefix="/api/v1", tags=["Pets"])
# app.include_router(advice.router, prefix="/api/v1", tags=["Advice"])
```

---

### 5. Automated Tests

Unit tests are critical for ensuring feature reliability and preventing regressions.

**File:** `petsage_api/tests/api/v1/test_health.py`
```python
# petsage_api/tests/api/v1/test_health.py

from fastapi.testclient import TestClient
from fastapi import status
from petsage_api.main import app

client = TestClient(app)

def test_health_check_returns_200_ok():
    """
    Tests that the /api/v1/health endpoint returns a 200 OK status code.
    """
    response = client.get("/api/v1/health")
    assert response.status_code == status.HTTP_200_OK

def test_health_check_response_body_is_correct():
    """
    Tests that the /api/v1/health endpoint returns the expected JSON body,
    adhering to the HealthCheckResponse schema.
    """
    response = client.get("/api/v1/health")
    expected_json = {
        "status": "ok",
        "message": "PetSage system is wagging its tail!"
    }
    assert response.json() == expected_json

def test_health_check_headers():
    """
    Tests that the response includes standard and secure headers.
    """
    response = client.get("/api/v1/health")
    assert "content-type" in response.headers
    assert response.headers["content-type"] == "application/json"
```

---

### 6. Documentation & Review

*   **OpenAPI Docs:** The code generated above includes detailed docstrings, summaries, and Pydantic Field descriptions. This will automatically populate the interactive API documentation.
*   **Access:** Once the server is running, documentation can be viewed at `http://127.0.0.1:8000/docs`.
*   **Review:** The code is clean, follows the blueprint, and is ready for peer review and deployment.

**Build Complete.** The `smoke_test` feature has been successfully generated and is ready for integration.

**[PetSage Backend Feature Builder Agent]**
Status: `IDLE`
Next Task: Awaiting new payload.